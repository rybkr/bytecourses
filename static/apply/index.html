<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply to Teach - The Byte Course Project</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
    <header>
        <h1><a href="/" style="text-decoration: none; color: inherit;">The Byte Course Project</a></h1>
        <nav style="display: flex; gap: var(--spacing-md); align-items: center;">
            <a href="/"
                style="text-decoration: none; color: var(--color-text); padding: var(--spacing-sm) var(--spacing-md); border-radius: var(--radius-sm);">Home</a>
            <a href="/about/"
                style="text-decoration: none; color: var(--color-text); padding: var(--spacing-sm) var(--spacing-md); border-radius: var(--radius-sm);">About</a>
            <a href="/apply/"
                style="text-decoration: none; color: var(--color-text); padding: var(--spacing-sm) var(--spacing-md); border-radius: var(--radius-sm); background: rgba(233, 30, 99, 0.1);">Apply</a>
        </nav>
    </header>

    <main style="padding: var(--spacing-2xl) var(--spacing-xl);">
        <div id="authCheck" style="text-align: center; padding: var(--spacing-3xl);">
            <p>Checking authentication...</p>
        </div>

        <div id="applyContent" style="display: none;">
            <div class="form-container">
                <h2>Submit a Course</h2>
                <p style="color: var(--color-text-light); margin-bottom: var(--spacing-xl);">Create a course proposal
                    for admin review. You can save your progress and return later.</p>

                <div id="draftPrompt" class="draft-prompt" style="display: none;">
                    <p><strong>You have a saved draft.</strong> Would you like to load it?</p>
                    <div class="draft-preview" id="draftPreview"></div>
                    <div class="button-group" style="margin-top: var(--spacing-md);">
                        <button type="button" id="loadDraftBtn" class="btn-secondary">Load Draft</button>
                        <button type="button" id="discardDraftBtn" class="btn-secondary">Start Fresh</button>
                    </div>
                </div>

                <div id="draftStatus" class="draft-status" style="display: none;"></div>

                <form id="courseForm">
                    <div class="form-group">
                        <label for="title">Course Title</label>
                        <input type="text" id="title" name="title" maxlength="255" required>
                        <div class="field-hint">Choose a clear, descriptive title for your course</div>
                        <div class="char-counter" id="titleCounter">0 / 255 characters</div>
                        <div class="field-error" id="titleError"></div>
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" rows="6" required></textarea>
                        <div class="field-hint">Provide a detailed description of what students will learn</div>
                        <div class="char-counter" id="descriptionCounter">0 characters (minimum 10)</div>
                        <div class="field-error" id="descriptionError"></div>
                    </div>

                    <div class="button-group">
                        <button type="button" id="saveDraftBtn" class="btn-secondary">Save Draft</button>
                        <button type="submit" id="submitBtn" class="btn-primary">Submit for Approval</button>
                    </div>
                </form>
                <div id="formMessage"></div>
            </div>
        </div>

        <div id="loginPrompt"
            style="display: none; text-align: center; padding: var(--spacing-3xl); max-width: 500px; margin: 0 auto;">
            <h2>Login Required</h2>
            <p style="color: var(--color-text-light); margin-bottom: var(--spacing-xl);">You need to be logged in to
                submit a course.</p>
            <a href="/" class="btn-primary" style="display: inline-block; text-decoration: none;">Go to Home</a>
        </div>
    </main>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/courses.js"></script>
    <script>
        function escapeHtml(text) {
            const div = document.createElement("div");
            div.textContent = text;
            return div.innerHTML;
        }

        async function checkAuthAndInit() {
            const authCheck = document.getElementById("authCheck");
            const applyContent = document.getElementById("applyContent");
            const loginPrompt = document.getElementById("loginPrompt");

            const token = sessionStorage.getItem("authToken");
            if (!token) {
                authCheck.style.display = "none";
                loginPrompt.style.display = "block";
                return;
            }

            try {
                const payload = authModule.parseJWT(token);
                if (!payload) {
                    authCheck.style.display = "none";
                    loginPrompt.style.display = "block";
                    return;
                }

                if (payload.exp && payload.exp * 1000 < Date.now()) {
                    authCheck.style.display = "none";
                    loginPrompt.style.display = "block";
                    return;
                }

                authCheck.style.display = "none";
                applyContent.style.display = "block";

                coursesModule.init();
                coursesModule.checkForDraft();
            } catch (error) {
                authCheck.style.display = "none";
                loginPrompt.style.display = "block";
            }
        }

        document.addEventListener("DOMContentLoaded", checkAuthAndInit);
    </script>
</body>

</html>