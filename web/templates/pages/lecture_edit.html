{{template "layout" .}} {{define "title"}}Edit: {{.Reading.Title}} - ByteCourses{{end}} {{define "content"}}
{{template "course-navbar" .}}

<div class="lecture-edit-container">
    <nav class="course-page-actions course-page-actions-top" aria-label="Edit navigation">
        <a href="/courses/{{.Course.ID}}/modules/{{.Module.ID}}" class="btn btn-outline course-page-actions-back">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="15 18 9 12 15 6"></polyline></svg>
            Back to module
        </a>
        <a href="/courses/{{.Course.ID}}/modules/{{.Module.ID}}/content/{{.Reading.ID}}" class="btn btn-outline">View</a>
    </nav>

    <div id="lecture-error" class="error-message hidden"></div>

    <div class="lecture-edit-header">
        <div class="lecture-edit-header-left">
            <input type="text" id="lecture-title" class="lecture-title-input" value="{{.Reading.Title}}" placeholder="Reading title...">
        </div>
        <div class="lecture-edit-header-right">
            <span id="save-status" class="save-status"></span>
            <span class="content-status-badge content-status-{{.Reading.Status}}">{{.Reading.Status}}</span>
            {{if eq .Reading.Status "draft"}}
            <button type="button" id="publish-btn" class="btn btn-success">Publish</button>
            {{else}}
            <button type="button" id="unpublish-btn" class="btn btn-secondary">Unpublish</button>
            {{end}}
            <button type="button" id="save-btn" class="btn btn-primary">Save</button>
        </div>
    </div>

    <div class="lecture-editor" id="lecture-editor">
        <div class="lecture-editor-pane-header">
            <span id="editor-format-label">{{if eq .Reading.Format "markdown"}}Markdown{{else if eq .Reading.Format "plain"}}Plain Text{{else}}Rich Text{{end}}</span>
            <select id="lecture-format" class="format-selector">
                <option value="markdown" {{if eq .Reading.Format "markdown"}}selected{{end}}>Markdown</option>
                <option value="plain" {{if eq .Reading.Format "plain"}}selected{{end}}>Plain Text</option>
                <option value="html" {{if eq .Reading.Format "html"}}selected{{end}}>Rich Text</option>
            </select>
        </div>
        <div class="unified-editor-area"></div>
    </div>
</div>

<script>
    window.LECTURE_DATA = {
        courseId: {{.Course.ID}},
        moduleId: {{.Module.ID}},
        readingId: {{.Reading.ID}},
        order: {{.Reading.Order}},
        status: "{{.Reading.Status}}",
        format: "{{.Reading.Format}}",
        initialContent: {{printf "%q" (deref .Reading.Content)}}
    };
</script>
{{end}}

{{define "scripts"}}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css">
<script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3/dist/purify.min.js"></script>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdn.jsdelivr.net/npm/turndown@7/dist/turndown.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
<script type="module" src="/static/js/pages/lecture_edit.js"></script>
{{end}}
