{{template "layout" .}} {{define "title"}}{{.Proposal.Title}} -
ByteCourses{{end}} {{define "content"}}
<div class="page-header">
    <h1>{{.Proposal.Title}}</h1>
    <div class="header-actions">
        {{if ne .User.Role "admin"}}
        {{if or (eq .Proposal.Status "draft") (eq .Proposal.Status "changes_requested")}}
        <button id="submitBtn" class="btn btn-primary">Submit</button>
        <a href="/proposals/{{.Proposal.ID}}/edit" class="btn btn-secondary btn-sm">Edit</a>
        {{end}}
        {{if eq .Proposal.Status "submitted"}}
        <button id="withdrawBtn" class="btn btn-secondary btn-sm">Withdraw</button>
        {{end}}
        {{if ne .Proposal.Status "submitted"}}
        <button id="deleteBtn" class="btn btn-danger btn-sm" data-proposal-status="{{.Proposal.Status}}">Delete</button>
        {{end}}
        {{if eq .Proposal.Status "approved"}}
        {{if .CourseExists}}
        <a href="/courses/{{.ExistingCourseID}}/edit" class="btn btn-primary">Course Already Created</a>
        {{else}}
        <button id="createCourseBtn" class="btn btn-primary">Create Course</button>
        {{end}}
        {{end}}
        {{end}}
        <a href="/proposals" class="btn btn-outline">Back to Proposals</a>
    </div>
</div>
<div id="error-message" class="error-message hidden" data-proposal-id="{{.Proposal.ID}}"></div>

<div class="proposal-status-card {{if and .Proposal.ReviewNotes (eq .Proposal.Status "changes_requested")}}proposal-status-card-highlight{{end}}">
    <div class="proposal-status-header">
        <span class="status-badge proposal-view-status-badge status-{{.Proposal.Status}}">{{.Proposal.Status}}</span>
        <div class="proposal-status-context">
            {{if eq .User.Role "admin"}}
            {{if eq .Proposal.Status "submitted"}}Ready for review{{end}}
            {{if eq .Proposal.Status "approved"}}This proposal has been approved{{end}}
            {{if eq .Proposal.Status "rejected"}}This proposal has been rejected{{end}}
            {{if eq .Proposal.Status "changes_requested"}}Changes have been requested. Waiting for user to resubmit.{{end}}
            {{else}}
            {{if eq .Proposal.Status "draft"}}Ready to submit for review{{end}}
            {{if eq .Proposal.Status "submitted"}}Awaiting admin review{{end}}
            {{if eq .Proposal.Status "changes_requested"}}Please make the requested changes{{end}}
            {{if eq .Proposal.Status "approved"}}This proposal has been approved{{end}}
            {{if eq .Proposal.Status "rejected"}}This proposal has been rejected{{end}}
            {{if eq .Proposal.Status "withdrawn"}}This proposal has been withdrawn{{end}}
            {{end}}
        </div>
    </div>
    {{if eq .User.Role "admin"}}
    <div class="proposal-status-author">
        <span class="proposal-status-label">Author ID:</span>
        <span class="proposal-status-value">{{.Proposal.AuthorID}}</span>
    </div>
    {{end}}
    {{if and .Proposal.ReviewNotes (ne .Proposal.Status "submitted")}}
    <div class="proposal-status-review-notes">
        <h3>Review Notes</h3>
        <div class="proposal-status-review-content">{{markdown .Proposal.ReviewNotes}}</div>
        {{if .Proposal.ReviewerID}}
        <div class="proposal-status-review-meta">
            <span>Reviewed by Admin</span>
            <span>Updated: {{.Proposal.UpdatedAt.Format "January 2, 2006"}}</span>
        </div>
        {{end}}
    </div>
    {{end}}
    <div class="proposal-status-help">
        {{if eq .User.Role "admin"}}
        {{if eq .Proposal.Status "submitted"}}Review this proposal and provide feedback using the actions below.{{end}}
        {{if eq .Proposal.Status "approved"}}This proposal has been approved.{{end}}
        {{if eq .Proposal.Status "rejected"}}This proposal has been rejected.{{end}}
        {{if eq .Proposal.Status "changes_requested"}}Changes have been requested. Waiting for user to resubmit.{{end}}
        {{else}}
        {{if eq .Proposal.Status "draft"}}Complete your proposal and click Submit to send it for review.{{end}}
        {{if eq .Proposal.Status "submitted"}}Your proposal is under review. You'll be notified when an admin reviews it.{{end}}
        {{if eq .Proposal.Status "changes_requested"}}An admin has requested changes. Please review the feedback above and make the necessary edits, then resubmit.{{end}}
        {{if eq .Proposal.Status "approved"}}Congratulations! Your proposal has been approved.{{end}}
        {{if eq .Proposal.Status "rejected"}}This proposal has been rejected. Please review the feedback above.{{end}}
        {{if eq .Proposal.Status "withdrawn"}}This proposal has been withdrawn from review.{{end}}
        {{end}}
    </div>
</div>

{{if and (eq .User.Role "admin") (eq .Proposal.Status "submitted")}}
<div class="review-card">
    <h2>Review Proposal</h2>
    <div id="review-error" class="error-message hidden"></div>
    <div class="form-group">
        <label for="review-notes">Review Notes</label>
        <textarea id="review-notes" rows="4" placeholder="Add your review notes here...">{{.Proposal.ReviewNotes}}</textarea>
    </div>
    <div class="review-actions">
        <button id="approveBtn" class="btn btn-success">Approve</button>
        <button id="requestChangesBtn" class="btn btn-warning">
            Request Changes
        </button>
        <button id="rejectBtn" class="btn btn-danger">Reject</button>
    </div>
</div>
{{end}}
<div class="proposal-content">
    <h2>Summary</h2>
    <div class="proposal-content-value">{{markdown .Proposal.Summary}}</div>
    <h2>Qualifications</h2>
    <div class="proposal-content-value">{{markdown .Proposal.Qualifications}}</div>
    <h2>Target Audience</h2>
    <div class="proposal-content-value">{{markdown .Proposal.TargetAudience}}</div>
    <h2>Learning Objectives</h2>
    <div class="proposal-content-value">{{markdown .Proposal.LearningObjectives}}</div>
    <h2>Course Outline</h2>
    <div class="proposal-content-value">{{markdown .Proposal.Outline}}</div>
    <h2>Prerequisites</h2>
    <div class="proposal-content-value">{{markdown .Proposal.AssumedPrerequisites}}</div>
</div>
<div class="proposal-dates-footer">
    <span>Created: {{.Proposal.CreatedAt.Format "January 2, 2006"}}</span>
    <span>Updated: {{.Proposal.UpdatedAt.Format "January 2, 2006"}}</span>
</div>
{{end}} {{define "scripts"}}
<script type="module" src="/static/js/pages/proposal_view.js"></script>
{{end}}
