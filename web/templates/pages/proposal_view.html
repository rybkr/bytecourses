{{template "layout" .}} {{define "title"}}{{.Proposal.Title}} -
ByteCourses{{end}} {{define "content"}}
<div class="page-header">
    <h1>{{.Proposal.Title}}</h1>
    <div class="header-actions">
        {{if ne .User.Role "admin"}}
        <button id="submitBtn" class="btn btn-primary">Submit</button>
        {{if or (eq .Proposal.Status "draft") (eq .Proposal.Status "changes_requested")}}
        <a href="/proposals/{{.Proposal.ID}}/edit" class="btn btn-secondary">Edit</a>
        {{end}}
        {{end}}
        <a href="/proposals" class="btn btn-outline">Back to Proposals</a>
    </div>
</div>
<div id="error-message" class="error-message" style="display: none;"></div>
<div class="proposal-meta-bar">
    <span class="status-badge status-{{.Proposal.Status}}">{{.Proposal.Status}}</span>
    {{if eq .User.Role "admin"}}
    <span>Author ID: {{.Proposal.AuthorID}}</span>
    {{end}}
    <span>Created: {{.Proposal.CreatedAt.Format "January 2, 2006"}}</span>
    <span>Updated: {{.Proposal.UpdatedAt.Format "January 2, 2006"}}</span>
</div>
<div class="proposal-content">
    <h2>Summary</h2>
    <p class="proposal-content-value">{{.Proposal.Summary}}</p>
    <h2>Target Audience</h2>
    <p class="proposal-content-value">{{.Proposal.TargetAudience}}</p>
    <h2>Learning Objectives</h2>
    <p class="proposal-content-value">{{.Proposal.LearningObjectives}}</p>
</div>
{{end}} {{define "scripts"}}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const submitBtn = document.getElementById("submitBtn");
        const errorDiv = document.getElementById("error-message");
        const proposalId = {{.Proposal.ID }
    };

    async function submit() {
        errorDiv.style.display = "none";
        errorDiv.textContent = "";
        submitBtn.disabled = true;

        try {
            const res = await fetch(`/api/proposals/${proposalId}/actions/submit`, {
                method: "POST",
            });

            if (!res.ok) {
                const txt = await res.text();
                errorDiv.textContent = txt || "Submit failed";
                errorDiv.style.display = "block";
                submitBtn.disabled = false;
                return;
            }

            window.location.reload();
        } catch (error) {
            errorDiv.textContent = "Network error. Please try again.";
            errorDiv.style.display = "block";
            submitBtn.disabled = false;
        }
    }

    if (submitBtn) {
        submitBtn.addEventListener("click", submit);
    }
});
</script>
{{end}}